async function C(n,M=0){try{const t=window.tableau?.extensions?.dashboardContent?.dashboard?.worksheets;if(!t)throw new Error("Unable to access Tableau worksheets");const m=async y=>{const D=t.find(o=>o.name===y);if(!D)return console.log(`Worksheet "${y}" not found`),[];const a=await D.getSummaryDataAsync({maxRows:M}),b=a.columns.some(o=>o.fieldName==="Measure Names"),I=a.columns.some(o=>o.fieldName==="Measure Values"),d=[];if(b&&I){const o=a.columns.findIndex(e=>e.fieldName==="Measure Names"),r=a.columns.findIndex(e=>e.fieldName==="Measure Values"),c=a.columns.filter(e=>e.fieldName!=="Measure Names"&&e.fieldName!=="Measure Values"),s=new Map;for(const e of a.data){const i=c.map(l=>{const u=a.columns.findIndex(f=>f.fieldName===l.fieldName);return e[u].value}).join("|||");if(!s.has(i)){const l={};c.forEach(u=>{const f=a.columns.findIndex(V=>V.fieldName===u.fieldName);l[u.fieldName]=e[f].value}),s.set(i,l)}const p=s.get(i),v=e[o].value,$=e[r].value;p[v]=$}d.push(...Array.from(s.values()))}else for(const o of a.data){const r={};a.columns.forEach((c,s)=>{const e=o[s].value;r[c.fieldName]=e}),d.push(r)}return d};console.log(`Fetching main data for "${n}"...`);const h=await m(n);if(h.length===0)throw new Error(`Worksheet "${n}" not found or empty`);const w=`GC_${n}`;console.log(`Fetching Column Grand Totals from "${w}"...`);const g=await m(w),N=`RC_${n}`;console.log(`Fetching Row Grand Totals from "${N}"...`);const x=await m(N);return{main:h,gcData:g.length>0?g:null,rcData:x.length>0?x:null}}catch(t){throw console.error("Error fetching full dataset:",t),t}}export{C as fetchFullDataset};
